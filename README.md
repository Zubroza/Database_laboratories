**–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ "–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"**

–¢—É–º—É–Ω–±–∞—è—Ä–æ–≤ –¶—ã–±–µ–Ω –≥—Ä. 02271-–î–ë

Telegram [@fnsyqu]

## –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏:

**–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–π –∫–ª—É–± (—ç—Ç–æ–π —Ä–∞–±–æ—Ç—ã –Ω–µ—Ç –≤ [–ø–µ—Ä–µ—á–Ω–µ –∑–∞–¥–∞—á](https://edu.irnok.net/lib/exe/fetch.php?media=db:%D0%B2%D0%B0%D1%80%D0%B8%D0%B0%D0%BD%D1%82%D1%8B_%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B9_%D0%BF%D0%BE_%D1%83%D0%B4.pdf))**

<img src="https://cs14.pikabu.ru/post_img/2022/03/18/11/1647631703274010188.jpg" alt="–û–ø–∏—Å–∞–Ω–∏–µ" width="500">

*–°—É—â–Ω–æ—Å—Ç–∏*:  
–ö–ª–∏–µ–Ω—Ç—ã(ID, –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∏–º—è)  
–ö–æ–º–ø—å—é—Ç–µ—Ä—ã(ID, –º–æ–¥–µ–ª—å, –Ω–æ–º–µ—Ä –∫–æ–º–ø—å—Ç–µ—Ä–∞, —Å—Ç–∞—Ç—É—Å)  
–ú–æ–¥–µ–ª–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤(ID, CPU, GPU, RAM)  
–°–µ–∞–Ω—Å—ã(ID,–≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞, –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è, —Ü–µ–Ω–∞ –∑–∞ —á–∞—Å, ID –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, ID –∫–ª–∏–µ–Ω—Ç–∞)  
–ó–∞–∫–∞–∑ —É—Å–ª—É–≥(ID, ID –∫–ª–∏–µ–Ω—Ç–∞, ID —É—Å–ª—É–≥–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)  
–£—Å–ª—É–≥–∏(ID, —Ü–µ–Ω–∞, –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏)

*–ü—Ä–æ—Ü–µ—Å—Å—ã:*  
–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–≥—Ä–æ–≤—ã—Ö —Å–µ–∞–Ω—Å–æ–≤, –ø–æ–ª—É—á–µ–Ω–∏–µ —É—Å–ª—É–≥ (–µ–¥–∞, –Ω–∞–ø–∏—Ç–∏–∫–∏ –∏ –ø—Ä.).  
–í –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–∞–Ω—Å–µ –≤—Ö–æ–¥–∏—Ç –Ω–æ–º–µ—Ä –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, –µ–≥–æ –º–æ–¥–µ–ª—å, —Å—Ç–∞—Ç—É—Å –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç.

*–í—ã—Ö–æ–¥–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:*

–í—ã–≤–µ—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Å—Å–∏—è—Ö: ID –∫–ª–∏–µ–Ω—Ç–∞, –º–æ–¥–µ–ª–∏ –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, –≤—Ä–µ–º—è —Å–µ–∞–Ω—Å–∞ –∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Å—É–º–º–∞—Ä–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å–µ–∞–Ω—Å–∞

## –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 1. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–æ–π –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏ –ë–î

### ER-–¥–∏–∞–≥—Ä–∞–º–º–∞

```mermaid
erDiagram
    computer ||--o{ session : "–∏–º–µ–µ—Ç—Å—è"
    customer ||--o{ session : "—Å–æ–∑–¥–∞–µ—Ç"
    customer ||--o{ order : "–¥–µ–ª–∞–µ—Ç –∑–∞–∫–∞–∑—ã"
    model ||--o{ computer : "–∫–∞–∫–∞—è –º–æ–¥–µ–ª—å"
    service ||--o{ order : "–≤—ã–±–æ—Ä —É—Å–ª—É–≥–∏"

    computer {
        int computer_id PK
        string model_id FK
        int computer_num
        string status
    }
    
    session {
        int session_id PK
        string start_time
        string end_time
        int cost
        int computer_id FK
        int customer_id FK
    }
    
    customer {
        int customer_id PK
        string phone_number
        string name
        int balance
    }
    
    model {
        string model_id PK
        string CPU
        string GPU
        string RAM
    }
    
    service {
        string service_id PK
        int price
        string service_name
    }
    
    order {
        int order_id PK
        int customer_id FK
        string service_id FK
        int amount
    }
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º

### **–ü–µ—Ä–≤–∞—è –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ (1NF):**
‚úÖ **–°–æ–±–ª—é–¥–µ–Ω–∞.** –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º 1NF:
- –ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∞—Ç–æ–º–∞—Ä–Ω—ã (–Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∏–ª–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π)
- –í –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ –Ω–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –≥—Ä—É–ø–ø –¥–∞–Ω–Ω—ã—Ö
- –ü–æ—Ä—è–¥–æ–∫ —Å—Ç—Ä–æ–∫ –Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è

### **–í—Ç–æ—Ä–∞—è –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ (2NF):**
‚úÖ **–°–æ–±–ª—é–¥–µ–Ω–∞.** –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤–æ 2NF:
- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —É–∂–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ 1NF
- –í —Ç–∞–±–ª–∏—Ü–∞—Ö —Å —Å–æ—Å—Ç–∞–≤–Ω—ã–º–∏ –ø–µ—Ä–≤–∏—á–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ –≤—Å–µ –Ω–µ–∫–ª—é—á–µ–≤—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤—Å–µ–≥–æ —Å–æ—Å—Ç–∞–≤–Ω–æ–≥–æ –∫–ª—é—á–∞
- –í —Ç–∞–±–ª–∏—Ü–∞—Ö —Å –ø—Ä–æ—Å—Ç—ã–º–∏ –ø–µ—Ä–≤–∏—á–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ –Ω–µ–∫–ª—é—á–µ–≤—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤—Å–µ–≥–æ –∫–ª—é—á–∞
- –ß–∞—Å—Ç–∏—á–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ

### **–¢—Ä–µ—Ç—å—è –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ (3NF):**
‚úÖ **–°–æ–±–ª—é–¥–µ–Ω–∞.** –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º 3NF:
- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —É–∂–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤–æ 2NF
- –¢—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –Ω–µ–∫–ª—é—á–µ–≤—ã–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
- –í—Å–µ –Ω–µ–∫–ª—é—á–µ–≤—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∑–∞–≤–∏—Å—è—Ç –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –æ—Ç –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
- –í —Ç–∞–±–ª–∏—Ü–µ `model` –∞—Ç—Ä–∏–±—É—Ç—ã CPU, GPU, RAM –∑–∞–≤–∏—Å—è—Ç —Ç–æ–ª—å–∫–æ –æ—Ç model_id
- –í —Ç–∞–±–ª–∏—Ü–µ `service` —Ü–µ–Ω–∞ —É—Å–ª—É–≥–∏ –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç service_id

## –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 2. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü 
*–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü*

```sql
-- –¢–∞–±–ª–∏—Ü–∞ 'customers' (–ö–ª–∏–µ–Ω—Ç—ã)
CREATE TABLE tumunbayarovts02271.customers (
    customer_id SERIAL PRIMARY KEY,
    phone_number VARCHAR(255) NOT NULL,
    name VARCHAR(255) NOT NULL,
    balance INTEGER NOT NULL DEFAULT 0 CHECK (balance >= 0)
);

-- –¢–∞–±–ª–∏—Ü–∞ 'model' (–ú–æ–¥–µ–ª–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤)
CREATE TABLE tumunbayarovts02271.model (
    model_id INTEGER PRIMARY KEY,
    CPU VARCHAR(255) NOT NULL,
    GPU VARCHAR(255) NOT NULL,
    RAM VARCHAR(255) NOT NULL
);

-- –¢–∞–±–ª–∏—Ü–∞ 'computers' (–ö–æ–º–ø—å—é—Ç–µ—Ä—ã)
CREATE TABLE tumunbayarovts02271.computers (
    computer_id SERIAL PRIMARY KEY,
    model_id INTEGER NOT NULL REFERENCES tumunbayarovts02271.model(model_id),
    computer_num INTEGER NOT NULL CHECK (computer_num > 0),
    status VARCHAR(255) NOT NULL DEFAULT '—Å–≤–æ–±–æ–¥–µ–Ω' 
        CHECK (status IN ('—Å–≤–æ–±–æ–¥–µ–Ω', '–∑–∞–Ω—è—Ç', '–Ω–µ–∏—Å–ø—Ä–∞–≤–µ–Ω'))
);

-- –¢–∞–±–ª–∏—Ü–∞ 'service' (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏)
CREATE TABLE tumunbayarovts02271.service (
    service_id VARCHAR(255) PRIMARY KEY,
    price INTEGER NOT NULL CHECK (price >= 0),
    service_name VARCHAR(255) NOT NULL
);

-- –¢–∞–±–ª–∏—Ü–∞ 'session' (–ò–≥—Ä–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏)
CREATE TABLE tumunbayarovts02271.session (
    session_id SERIAL PRIMARY KEY,
    start_time VARCHAR(255) NOT NULL,
    end_time VARCHAR(255) NOT NULL,
    cost INTEGER NOT NULL CHECK (cost >= 0),
    computer_id INTEGER NOT NULL REFERENCES tumunbayarovts02271.computers(computer_id),
    customer_id INTEGER NOT NULL REFERENCES tumunbayarovts02271.customers(customer_id)
);

-- –¢–∞–±–ª–∏—Ü–∞ 'order' (–ó–∞–∫–∞–∑—ã —É—Å–ª—É–≥)
CREATE TABLE tumunbayarovts02271.order (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER NOT NULL REFERENCES tumunbayarovts02271.customers(customer_id),
    service_id VARCHAR(255) NOT NULL REFERENCES tumunbayarovts02271.service(service_id),
    amount INTEGER NOT NULL CHECK (amount > 0)
);
```
```sql
-- –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É 'customers'
INSERT INTO tumunbayarovts02271.customers (phone_number, name, balance) VALUES
('+7(900)123-45-67', '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', 5000),
('+7(900)765-43-21', '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', 12000),
('+7(901)111-22-33', '–ê–ª–µ–∫—Å–µ–π –ö—É–∑–Ω–µ—Ü–æ–≤', 3000),
('+7(902)222-33-44', '–ï–ª–µ–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞', 8000);

-- –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É 'model'
INSERT INTO tumunbayarovts02271.model (model_id, CPU, GPU, RAM) VALUES
(1, 'Intel Core i9-13900K', 'NVIDIA RTX 4090', '32GB DDR5'),
(2, 'AMD Ryzen 9 7950X', 'NVIDIA RTX 4080', '32GB DDR5'),
(3, 'Intel Core i7-13700K', 'NVIDIA RTX 4070 Ti', '16GB DDR5'),
(4, 'AMD Ryzen 7 7800X3D', 'NVIDIA RTX 4060', '16GB DDR5');

-- –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É 'computers'
INSERT INTO tumunbayarovts02271.computers (model_id, computer_num, status) VALUES
(1, 1, '—Å–≤–æ–±–æ–¥–µ–Ω'),
(1, 2, '–∑–∞–Ω—è—Ç'),
(2, 3, '–Ω–µ–∏—Å–ø—Ä–∞–≤–µ–Ω'),
(3, 4, '–∑–∞–Ω—è—Ç'),
(4, 5, '—Å–≤–æ–±–æ–¥–µ–Ω'),
(2, 6, '–∑–∞–Ω—è—Ç');

-- –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É 'service'
INSERT INTO tumunbayarovts02271.service (service_id, price, service_name) VALUES
('snack', 300, '–°–Ω–µ–∫–∏ –∏ –Ω–∞–ø–∏—Ç–∫–∏'),
('support', 500, '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞'),
('training', 1000, '–û–±—É—á–µ–Ω–∏–µ –∏–≥—Ä–∞–º'),
('vr', 1500, '–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å'),
('print', 50, '–ü–µ—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤');

-- –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É 'session'
INSERT INTO tumunbayarovts02271.session (start_time, end_time, cost, computer_id, customer_id) VALUES
('2024-01-15 14:00:00', '2024-01-15 16:30:00', 1500, 2, 1),
('2024-01-15 18:00:00', '2024-01-15 20:00:00', 1200, 4, 2),
('2024-01-16 12:00:00', '2024-01-16 15:00:00', 1800, 6, 3),
('2024-01-16 16:00:00', '2024-01-16 17:00:00', 600, 1, 4),
('2024-01-17 19:00:00', '2024-01-17 22:00:00', 2100, 2, 1);

-- –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É 'order'
INSERT INTO tumunbayarovts02271."order" (customer_id, service_id, amount) VALUES
(1, 'snack', 2),
(1, 'support', 1),
(2, 'training', 1),
(3, 'vr', 2),
(4, 'print', 5),
(2, 'snack', 3);
```
```sql
SELECT 
    c.name,
    s.session_id,
    s.start_time,
    s.end_time,
    s.cost,
    comp.computer_num,
    serv.service_name,
    o.amount,
    serv.price,
    (o.amount * serv.price) AS total_sum
FROM tumunbayarovts02271.customers c
LEFT JOIN tumunbayarovts02271.session s ON c.customer_id = s.customer_id
LEFT JOIN tumunbayarovts02271."order" o ON c.customer_id = o.customer_id
LEFT JOIN tumunbayarovts02271.computers comp ON s.computer_id = comp.computer_id
LEFT JOIN tumunbayarovts02271.service serv ON o.service_id = serv.service_id
ORDER BY c.customer_id, s.session_id, o.order_id;
```

## –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 3. –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
*–¶–µ–ª—å*: –û—Å–≤–æ–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö –º–æ–¥—É–ª–µ–π.

üìã –ó–∞–¥–∞—á–∏:

1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –¥–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
2. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ö—Ä–∞–Ω–∏–º—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
3. –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –¥–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
–í—ã–≤–µ—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Å—Å–∏—è—Ö: ID –∫–ª–∏–µ–Ω—Ç–∞, –º–æ–¥–µ–ª–∏ –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, –≤—Ä–µ–º—è —Å–µ–∞–Ω—Å–∞ –∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Å—É–º–º–∞—Ä–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å–µ–∞–Ω—Å–∞
```sql
CREATE OR REPLACE VIEW tumunbayarovts02271.sessions_info
 AS
 SELECT st.session_id,
    cust_t.name,
    st.computer_id,
    ct.model_id,
    abs(st.end_time::double precision - st.start_time::double precision) AS session_time,
    st.cost_per_hour,
    st.cost_per_hour::double precision * abs(st.end_time::double precision - st.start_time::double precision) AS session_cost
   FROM tumunbayarovts02271.sessions_table st
     JOIN tumunbayarovts02271.customers_table cust_t ON st.customer_id = cust_t.customer_id
     JOIN tumunbayarovts02271.computers_table ct ON st.computer_id = ct.computer_id
  ORDER BY (st.cost_per_hour::double precision * abs(st.end_time::double precision - st.start_time::double precision)) DESC;

ALTER TABLE tumunbayarovts02271.sessions_info
    OWNER TO student;
```
### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä  
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞:
```sql
CREATE OR REPLACE PROCEDURE public.add_new_customer(
	IN id integer,
	IN n_name character varying,
	IN n_phone_number character varying)
LANGUAGE 'plpgsql'
AS $BODY$
BEGIN

INSERT INTO tumunbayarovts02271.customers_table(customer_id,name,phone_number,balance)

VALUES
 	(id,n_name,n_phone_number,0);

END;
$BODY$;
ALTER PROCEDURE public.add_new_customer(integer, character varying, character varying)
    OWNER TO student;
```
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞:
```sql
CREATE OR REPLACE PROCEDURE public.update_customer_info(
	IN id integer,
	IN new_name character varying,
	IN new_phone_number character varying)
LANGUAGE 'plpgsql'
AS $BODY$
BEGIN
 	UPDATE tumunbayarovts02271.customers_table
   	SET 
      		phone_number = new_phone_number,
      		name = new_name,
		balance = 0
  	WHERE customer_id = id;
END;
$BODY$;
ALTER PROCEDURE public.update_customer_info(integer, character varying, character varying)
    OWNER TO student;
```
–ó–∞–ø—Ä–æ—Å—ã –∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º:

```sql
-- –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
SELECT * FROM tumunbayarovts02271.sessions_info;

-- –ó–∞–ø—Ä–æ—Å —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º
SELECT 
    session_id,
    name AS "–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞",
    computer_id AS "ID –∫–æ–º–ø—å—é—Ç–µ—Ä–∞",
    model_id AS "–ú–æ–¥–µ–ª—å",
    session_time AS "–í—Ä–µ–º—è —Å–µ—Å—Å–∏–∏ (—á–∞—Å—ã)",
    cost_per_hour AS "–°—Ç–æ–∏–º–æ—Å—Ç—å –≤ —á–∞—Å",
    session_cost AS "–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å"
FROM tumunbayarovts02271.sessions_info
WHERE session_cost > 1000
ORDER BY name, session_id;

-- –ó–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º
SELECT 
    name AS "–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞",
    COUNT(*) AS "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π",
    SUM(session_time) AS "–û–±—â–µ–µ –≤—Ä–µ–º—è (—á–∞—Å—ã)",
    SUM(session_cost) AS "–û–±—â–∞—è —Å—É–º–º–∞"
FROM tumunbayarovts02271.sessions_info
GROUP BY name
ORDER BY SUM(session_cost) DESC;

-- –ó–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞–º
SELECT 
    computer_id AS "ID –∫–æ–º–ø—å—é—Ç–µ—Ä–∞",
    model_id AS "–ú–æ–¥–µ–ª—å",
    COUNT(*) AS "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π",
    SUM(session_time) AS "–û–±—â–µ–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã (—á–∞—Å—ã)",
    SUM(session_cost) AS "–û–±—â–∏–π –¥–æ—Ö–æ–¥"
FROM tumunbayarovts02271.sessions_info
GROUP BY computer_id, model_id
ORDER BY SUM(session_cost) DESC;

-- –ó–∞–ø—Ä–æ—Å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫
SELECT * FROM tumunbayarovts02271.sessions_info
LIMIT 10;

-- –ó–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö —Å–µ—Å—Å–∏–π
SELECT 
    name AS "–ö–ª–∏–µ–Ω—Ç",
    session_time AS "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å—ã)",
    session_cost AS "–°—Ç–æ–∏–º–æ—Å—Ç—å"
FROM tumunbayarovts02271.sessions_info
ORDER BY session_cost DESC
LIMIT 5;

-- –ó–∞–ø—Ä–æ—Å —Å JOIN –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏)
SELECT 
    si.*,
    ct.computer_num AS "–ù–æ–º–µ—Ä –∫–æ–º–ø—å—é—Ç–µ—Ä–∞",
    ct.status AS "–°—Ç–∞—Ç—É—Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞"
FROM tumunbayarovts02271.sessions_info si
JOIN tumunbayarovts02271.computers_table ct ON si.computer_id = ct.computer_id;
```

## –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 4. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–¶–µ–ª—å: –û—Å–≤–æ–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ë–î.

üìã –ó–∞–¥–∞—á–∏:

1. –°–æ–∑–¥–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (20 000 –∑–∞–ø–∏—Å–µ–π –≤ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ)
2. –ê–Ω–∞–ª–∏–∑ –ø–ª–∞–Ω–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (EXPLAIN ANALYZE)
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
4. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ/–ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –°–æ–∑–¥–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (20 000 –∑–∞–ø–∏—Å–µ–π –≤ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ)

–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∫–ª–∏–µ–Ω—Ç–æ–≤:
```sql
CREATE OR REPLACE FUNCTION tumunbayarovts02271.generate_random_customers(
    p_count INTEGER DEFAULT 20000,
    p_start_id INTEGER DEFAULT 1
)
RETURNS VOID AS $$
BEGIN
    INSERT INTO tumunbayarovts02271.customers_table (customer_id, name, phone_number, balance)
    SELECT
        p_start_id + i - 1 AS customer_id,
        (ARRAY['–ò–≤–∞–Ω', '–ü–µ—Ç—Ä', '–°–µ—Ä–≥–µ–π', '–ê–ª–µ–∫—Å–µ–π', '–î–º–∏—Ç—Ä–∏–π', '–ê–Ω–¥—Ä–µ–π', '–ú–∏—Ö–∞–∏–ª', '–í–ª–∞–¥–∏–º–∏—Ä', '–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω', '–ï–≤–≥–µ–Ω–∏–π','–ê–Ω–Ω–∞','–ó–∏–Ω–∞–∏–¥–∞'])[floor(random() * 12) + 1] AS name,
        '8' || LPAD(floor(random() * 10000000000)::text, 10, '0') AS phone_number,
        floor(random()*100000)::numeric as balance
    FROM
        generate_series(1, p_count) AS t(i);
END;
$$ LANGUAGE plpgsql;
```
–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∑–∞–∫–∞–∑–æ–≤:

```sql
-- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º generate_series
CREATE OR REPLACE FUNCTION tumunbayarovts02271.generate_random_orders(
    p_count INTEGER DEFAULT 10000,
    p_start_id INTEGER DEFAULT 1
)
RETURNS VOID AS $$
BEGIN
    INSERT INTO tumunbayarovts02271.order (order_id, customer_id, service_id, amount)
    SELECT
        p_start_id + i - 1 AS order_id,
        -- –°–ª—É—á–∞–π–Ω—ã–π customer_id –æ—Ç 1 –¥–æ 20000
        floor(random() * 20000)::integer + 1 AS customer_id,
        -- –°–ª—É—á–∞–π–Ω—ã–π service_id –∏–∑ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
        (ARRAY['snack', 'support', 'training', 'vr', 'print'])[floor(random() * 5) + 1] AS service_id,
        -- –°–ª—É—á–∞–π–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç 1 –¥–æ 10
        floor(random() * 10)::integer + 1 AS amount
    FROM
        generate_series(1, p_count) AS t(i);
END;
$$ LANGUAGE plpgsql;
```
### –ê–Ω–∞–ª–∏–∑ –ø–ª–∞–Ω–∞ –≤—ã–ø–æ–ª–µ–Ω–∏—è:

```sql
EXPLAIN ANALYZE
SELECT *
FROM tumunbayarovts02271.customers_table AS ct
JOIN tumunbayarovts02271.orders_table AS ot ON ot.customer_id = ct.customer_id
WHERE ct.balance < 30000 AND ct.name = '–ü–µ—Ç—Ä'
ORDER BY balance ASC;
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤:

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ —Å—Ç–æ–ª–±–µ—Ü –±–∞–ª–∞–Ω—Å–∞
CREATE INDEX balance_idx ON tumunbayarovts02271.customers_table(balance);

-- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ —Å—Ç–æ–ª–±–µ—Ü –∏–º–µ–Ω
CREATE INDEX name_idx ON tumunbayarovts02271.customers_table(name);
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ –∏ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤:

–î–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤: 11.773 ms

<img src="./pictures/before_index_add.jpg" alt="–§–æ—Ç–æ –¥–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏. –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 11.773" width="500">

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤: 3.737 ms

<img src="./pictures/after_index_add.jpg" alt="–§–æ—Ç–æ –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏. –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 3.737" width="500">

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏–ª–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞.

## –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 5. –¢—Ä–∏–≥–≥–µ—Ä—ã –∏ –∞—É–¥–∏—Ç

*–¶–µ–ª—å*: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î –∏ —Å–∏—Å—Ç–µ–º—ã –∞—É–¥–∏—Ç–∞.

üìã –ó–∞–¥–∞—á–∏:

1. –¢—Ä–∏–≥–≥–µ—Ä—ã –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è —Å–≤—è–∑–µ–π ‚Äú–æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º‚Äù
2. –¢—Ä–∏–≥–≥–µ—Ä—ã –∞—É–¥–∏—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π (INSERT, UPDATE, DELETE)
3. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã-–∂—É—Ä–Ω–∞–ª–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –¢—Ä–∏–≥–≥–µ—Ä—ã –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è —Å–≤—è–∑–µ–π ‚Äú–æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º‚Äù

–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞:

```sql
CREATE OR REPLACE FUNCTION tumunbayarovts02271.cascade_delete_customer_orders()
    RETURNS trigger
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE NOT LEAKPROOF
AS $BODY$
BEGIN
    INSERT INTO tumunbayarovts02271.audit_log (
        table_name, stamp, operation, old_data, new_data
    )
    SELECT 
        'orders_table', CURRENT_TIMESTAMP, 'CASCADE_DELETE', row_to_json(o), NULL
    FROM tumunbayarovts02271.orders_table o
    WHERE o.customer_id = OLD.customer_id;
    
    DELETE FROM tumunbayarovts02271.orders_table 
    WHERE customer_id = OLD.customer_id;
    RETURN OLD;
END;
$BODY$;

ALTER FUNCTION tumunbayarovts02271.cascade_delete_customer_orders()
    OWNER TO student;
```

–£–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π –∫–ª–∏–µ–Ω—Ç–∞:

```sql
CREATE OR REPLACE FUNCTION tumunbayarovts02271.cascade_delete_customer_sessions()
    RETURNS trigger
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE NOT LEAKPROOF
AS $BODY$
BEGIN
    INSERT INTO tumunbayarovts02271.audit_log (
        table_name, stamp, operation, old_data, new_data
    )
    SELECT 
        'sessions_table', CURRENT_TIMESTAMP, 'CASCADE_DELETE', row_to_json(s), NULL
    FROM tumunbayarovts02271.sessions_table s
    WHERE s.customer_id = OLD.customer_id;
    
    DELETE FROM tumunbayarovts02271.sessions_table 
    WHERE customer_id = OLD.customer_id;
    RETURN OLD;
END;
$BODY$;

ALTER FUNCTION tumunbayarovts02271.cascade_delete_customer_sessions()
    OWNER TO student;
```

### –¢—Ä–∏–≥–≥–µ—Ä—ã –∞—É–¥–∏—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π (INSERT, UPDATE, DELETE)

```sql
CREATE OR REPLACE FUNCTION tumunbayarovts02271.audit_trigger_function()
    RETURNS trigger
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE NOT LEAKPROOF
AS $BODY$
BEGIN
    --INSERT
    IF TG_OP = 'INSERT' THEN
        INSERT INTO tumunbayarovts02271.audit_log (
            table_name, stamp, operation, new_data
        ) VALUES (
            TG_TABLE_NAME, 
            CURRENT_TIMESTAMP, 
            'INSERT', 
            row_to_json(NEW)
        );
        
    --UPDATE
    ELSIF TG_OP = 'UPDATE' THEN
        INSERT INTO tumunbayarovts02271.audit_log (
            table_name, stamp, operation, old_data, new_data
        ) VALUES (
            TG_TABLE_NAME, 
            CURRENT_TIMESTAMP, 
            'UPDATE', 
            row_to_json(OLD), 
            row_to_json(NEW)
        );
        
    -- DELETE
    ELSIF TG_OP = 'DELETE' THEN
        INSERT INTO tumunbayarovts02271.audit_log (
            table_name, stamp, operation, old_data
        ) VALUES (
            TG_TABLE_NAME, 
            CURRENT_TIMESTAMP, 
            'DELETE', 
            row_to_json(OLD)
        );
    END IF;
    
    RETURN COALESCE(NEW, OLD);
END;
$BODY$;

ALTER FUNCTION tumunbayarovts02271.audit_trigger_function()
    OWNER TO student;
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã-–∂—É—Ä–Ω–∞–ª–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

```sql
CREATE TABLE IF NOT EXISTS tumunbayarovts02271.audit_log
(
    audit_id integer NOT NULL DEFAULT nextval('tumunbayarovts02271.audit_log_audit_id_seq'::regclass),
    table_name character varying(100) COLLATE pg_catalog."default" NOT NULL,
    stamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    operation character varying(50) COLLATE pg_catalog."default" NOT NULL,
    old_data jsonb,
    new_data jsonb,
    CONSTRAINT audit_log_pkey PRIMARY KEY (audit_id),
    CONSTRAINT audit_log_operation_check CHECK (operation::text = ANY (ARRAY['INSERT'::character varying, 'UPDATE'::character varying, 'DELETE'::character varying, 'CASCADE_DELETE'::character varying]::text[]))
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS tumunbayarovts02271.audit_log
    OWNER to student;
```

–†–∞–±–æ—Ç–∞–µ—Ç:

<img src="./pictures/audit_log.jpg" alt="audit_log —Ä–∞–±–æ—Ç–∞–µ—Ç" width="500">
